var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},com;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._displayWidth=-1,e._displayHeight=-1,e.isToStage=!1,e.isCreated=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.toStageHandler,e),e}return __extends(e,t),Object.defineProperty(e.prototype,"displayWidth",{get:function(){return this._displayWidth},set:function(t){this._displayWidth=t,this.resetPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayHeighth",{get:function(){return this._displayHeight},set:function(t){this._displayHeight=t,this.resetPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayRectangle",{get:function(){return this._displayRectangle},set:function(t){this._displayRectangle=t,this.resetPosition()},enumerable:!0,configurable:!0}),e.prototype.resetDisplaySize=function(t,e){this._displayWidth=t,this._displayHeight=e,this.resetPosition()},e.prototype.startLogic=function(){},e.prototype.resetPosition=function(){this.x=this._displayRectangle.x+(this._displayRectangle.width-this.displayWidth)/2,this.y=this.displayRectangle.y+(this.displayRectangle.height-this.displayHeighth)/2},e.prototype.toStageHandler=function(t){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.offStageHandler,this),this.isToStage=!0,this.isCreated&&this.startLogic()},e.prototype.childrenCreated=function(){this.isCreated=!0,this.isToStage&&this.startLogic()},e.prototype.offStageHandler=function(t){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.offStageHandler,this)},e.prototype.destory=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.toStageHandler,this),this.offStageHandler(null)},e}(egret.Sprite);t.BaseUI=e,__reflect(e.prototype,"com.lion.display.BaseUI")}(e=t.display||(t.display={}))}(e=t.lion||(t.lion={}))}(com||(com={}));var com;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(i,n){void 0===n&&(n=null);var s=e.call(this)||this;return s.mainScene=i,null==n?s.animateVo=new t.lion.data.AnimateConfigVo:s.animateVo=n,s}return __extends(i,e),i.prototype.show=function(t){this.showData=t,egret.Tween.removeTweens(this),this.mainScene.addChild(this),this.y=this.animateVo.animateDistance,this.alpha=0,egret.Tween.get(this).to({y:0,alpha:1},this.animateVo.animateTime).call(this.showAnimateOver)},i.prototype.hide=function(){this.touchChildren=!1,egret.Tween.removeTweens(this),egret.Tween.get(this).to({y:this.animateVo.animateDistance,alpha:0},this.animateVo.animateTime).call(this.hideAnimateOver)},i.prototype.hideAnimateOver=function(){this.alpha=1,this.y=0,this.parent&&this.mainScene.removeChild(this)},i.prototype.showAnimateOver=function(){this.touchChildren=!0},i}(e.BaseUI);e.BaseScene=i,__reflect(i.prototype,"com.lion.display.BaseScene")}(i=e.display||(e.display={}))}(e=t.lion||(t.lion={}))}(com||(com={}));var com;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t,e){void 0===t&&(t=.5),void 0===e&&(e=50),this.animateTime=t,this.animateDistance=e}return t}();t.AnimateConfigVo=e,__reflect(e.prototype,"com.lion.data.AnimateConfigVo")}(e=t.data||(t.data={}))}(e=t.lion||(t.lion={}))}(com||(com={}));var com;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){if(this.shape=new egret.Shape,t.instance)throw new Error("enterframe manager is singlon");this.frameNumber=0,this.items=[],this.shape.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.enterFrameHandler=function(t){this.frameNumber++;for(var e=0;e<this.items.length;e++)this.items[e].updateFrame(this.frameNumber)},t.prototype.addItem=function(t){var e=this.items.indexOf(t);-1==e&&this.items.push(t)},t.prototype.removeItem=function(t){var e=this.items.indexOf(t);-1!=e&&this.items.splice(e,1)},t.prototype.destory=function(){t.instance&&(this.shape.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.items=[],t.instance=null)},t}();t.EnterFrameManager=e,__reflect(e.prototype,"com.lion.managers.EnterFrameManager")}(e=t.managers||(t.managers={}))}(e=t.lion||(t.lion={}))}(com||(com={}));var com;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.childrenRemainedNum=0,e.sceneMap={},e}return __extends(e,t),e.prototype.registScene=function(t,e){this.destoryScene(t),this.sceneMap[t]=e},e.prototype.getSceneById=function(t){return this.sceneMap[t]},e.prototype.init=function(){},e.prototype.toStageHandler=function(e){t.prototype.toStageHandler.call(this,e),this.init()},e.prototype.switchScene=function(t,e){if(void 0===e&&(e=null),this.currentSceneId!=t){this.clearScene(),this.currentSceneId=t;var i=this.getSceneById(t);return i?void i.show(e):void console.log("no scene for id: "+t)}},e.prototype.destoryScene=function(t){var e=this.getSceneById(t);e&&e.destory(),delete this.sceneMap[t]},e.prototype.clearScene=function(){var t=this.getSceneById(this.currentSceneId);t&&t.hide()},e}(t.BaseUI);t.BaseMainScene=e,__reflect(e.prototype,"com.lion.display.BaseMainScene")}(e=t.display||(t.display={}))}(e=t.lion||(t.lion={}))}(com||(com={}));var com;!function(t){var e;!function(t){var e;!function(t){var e=function(){function e(){if(e.instance)throw new Error("second manager is singlon");e.instance=this,this.seconds=0,this.items=[],this.lastTime=egret.getTimer(),this.seconds=0,t.EnterFrameManager.getInstance().addItem(this)}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.updateFrame=function(t){var i=egret.getTimer();if(i-this.lastTime-this.seconds*e.secondTime>e.secondTime){this.seconds=Math.floor((i-this.lastTime)/e.secondTime),console.log(this.items);for(var n=this.items.length-1;n>-1;n--)this.items[n].updateSecond(this.seconds)}},e.prototype.addItem=function(t){var e=this.items.indexOf(t);-1==e&&this.items.push(t)},e.prototype.removeItem=function(t){var e=this.items.indexOf(t);-1!=e&&this.items.splice(e,1)},e.prototype.destory=function(){e.instance&&(t.EnterFrameManager.getInstance().removeItem(this),this.items=[],e.instance=null)},e}();e.secondTime=1e3,t.SecondManager=e,__reflect(e.prototype,"com.lion.managers.SecondManager",["com.lion.managers.interfaces.IEnterFrameAble"])}(e=t.managers||(t.managers={}))}(e=t.lion||(t.lion={}))}(com||(com={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.addChild(new MainScene(5,5))},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var MainScene=function(t){function e(e,i){var n=t.call(this)||this;return n.colNum=4,n.rowNum=4,n.space=20,n.gap=5,n.len=50,n.needAnimate=!0,n.aniTime=300,n.aniSpeed=600,n.timeSpend=0,n.score=0,n.minDis=20,n.colNum=i,n.rowNum=e,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.init,n),n}return __extends(e,t),e.prototype.init=function(){this.squareLayer=new egret.Sprite,this.touchLayer=new egret.Sprite,this.addChild(this.squareLayer),this.addChild(this.touchLayer);var t=1/15,e=4/15;this.len=1080/(e+(1+t)*this.colNum+e),this.gap=this.len*t,this.space=this.len*e;for(var i=0;i<this.rowNum;i++)for(var n=0;n<this.colNum;n++){var s=new egret.Shape;s.graphics.beginFill(15395562,.8),s.graphics.drawRoundRect(this.space+this.gap+n*(this.gap+this.len),this.space+this.gap+i*(this.gap+this.len),this.len,this.len,this.len/4,this.len/4),s.graphics.endFill(),this.squareLayer.addChild(s)}s=new egret.Shape,s.graphics.lineStyle(this.space/10,13395456,.5),s.graphics.moveTo(this.space,this.space),s.graphics.lineTo(this.gap+this.space+(this.len+this.gap)*this.colNum,this.space),s.graphics.lineTo(this.gap+this.space+(this.len+this.gap)*this.colNum,this.gap+this.space+(this.len+this.gap)*this.rowNum),s.graphics.lineTo(this.space,this.gap+this.space+(this.len+this.gap)*this.rowNum),s.graphics.lineTo(this.space,this.space),this.squareLayer.addChild(s),this.timeTxt=new egret.TextField,this.scoreTxt=new egret.TextField,this.timeTxt.width=this.scoreTxt.width=500,this.timeTxt.height=this.scoreTxt.height=this.len/2,this.timeTxt.x=this.space+this.gap,this.scoreTxt.x=540+this.space,this.timeTxt.y=this.scoreTxt.y=this.space,this.timeTxt.size=this.scoreTxt.size=this.len/3,this.addChild(this.timeTxt),this.addChild(this.scoreTxt),this.timeTxt.textAlign=egret.HorizontalAlign.LEFT,this.scoreTxt.textAlign=egret.HorizontalAlign.LEFT,this.timeTxt.text="Time: ",this.scoreTxt.text="Score: ",this.squareLayer.y=this.timeTxt.y+this.timeTxt.height-this.space,this.beginPoint=new egret.Point,this.initKey(),this.squareMap=new SquareMap(this.rowNum,this.colNum),this.addRandomSquare(),com.lion.managers.SecondManager.getInstance().addItem(this)},e.prototype.updateSecond=function(t){this.timeSpend++,console.log(this.timeSpend),this.timeTxt.text="Time: "+this.getTimeString(this.timeSpend)},e.prototype.addScore=function(t){this.score+=t,this.scoreTxt.text="Score: "+this.score},e.prototype.initKey=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEndHandler,this)},e.prototype.unableKey=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEndHandler,this)},e.prototype.touchBeginHandler=function(t){this.beginPoint.x=t.stageX,this.beginPoint.y=t.stageY},e.prototype.touchEndHandler=function(t){var e=this.beginPoint.x-t.stageX,i=this.beginPoint.y-t.stageY;if(!(Math.abs(e)<this.minDis&&Math.abs(i)<this.minDis)){var n=0;n=Math.abs(e)>Math.abs(i)?0>e?4:3:0>i?2:1,this.animateSquares(n)}},e.prototype.animateSquares=function(t){if(this.addScore(this.squareMap.moveSquares(t)),this.squareMap.anyChange){this.unableKey();var e=this.squareMap.getAllSquares();if(this.needAnimate)for(var i=0;i<e.length;i++){var n=e[i],s=this.getPositionByIndexes(n.position.y,n.position.x);n.alpha=1,i!=e.length-1?egret.Tween.get(n).to({x:s.x,y:s.y},this.aniTime):egret.Tween.get(n).to({x:s.x,y:s.y},this.aniTime).call(this.animateOver,this,[e])}else{for(i=0;i<e.length;i++)n=e[i],s=this.getPositionByIndexes(n.position.y,n.position.x),n.alpha=1,n.x=s.x,n.y=s.y;this.animateOver(e)}}},e.prototype.animateOver=function(t){this.squareMap.updateSquares(),this.squareMap.resetMap();for(var e=0;e<t.length;e++)t[e].isRemoved?this.squareLayer.removeChild(t[e]):(t[e].isMegered=!1,this.squareMap.setSquare(t[e]));return this.addRandomSquare(),this.squareMap.checkAlive()?void this.initKey():(console.log("dead"),void com.lion.managers.SecondManager.getInstance().removeItem(this))},e.prototype.addRandomSquare=function(){var t=this.getRandomSquare();if(t){this.squareLayer.addChild(t),this.squareMap.setSquare(t);var e=this.getPositionByIndexes(t.position.y,t.position.x);t.x=e.x,t.y=e.y,t.width=this.len,t.height=this.len,t.alpha=0,egret.Tween.get(t).to({alpha:1},this.aniTime)}},e.prototype.getPositionByIndexes=function(t,e){var i=new egret.Point;return i.x=this.space+this.gap+e*(this.gap+this.len),i.y=this.space+this.gap+t*(this.gap+this.len),i},e.prototype.getRandomSquare=function(){var t=this.borrowSquare(),e=this.squareMap.getAvailablePosition();return e?(t.position=e,t):null},e.prototype.borrowSquare=function(){return new Square(this.len)},e.prototype.returnSquare=function(t){t=null},e.prototype.getTimeString=function(t,e){void 0===e&&(e=!1);var i,n="",s=Math.floor(t/3600).toString();i=e?Math.floor(t%3600/60).toString():Math.floor(t/60).toString();var o=(t%60).toString();return s=s.length<2?"0"+s:s,i=i.length<2?"0"+i:i,o=o.length<2?"0"+o:o,n=e?s+" : "+i+" : "+o:i+" : "+o},e}(egret.Sprite);__reflect(MainScene.prototype,"MainScene",["com.lion.managers.interfaces.ISecondCountable"]);var Square=function(t){function e(e){var i=t.call(this)||this;return i.isMegered=!1,i.isRemoved=!1,i.num=2,i.len=80,i.colors=[14265773,15120265,15909473,16763904,16750949,16750898,16750848,16737794,16724736,13382144,13369344,10092544],i.values=[2,4,8,16,32,64,128,256,512,1024,2048,4096],i.len=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){this.txt=new egret.TextField,this.txt.width=this.len,this.txt.height=this.len,this.txt.size=this.len/3,this.txt.textAlign=egret.HorizontalAlign.CENTER,this.txt.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(this.txt),this.update()},e.prototype.update=function(){if(this.num){for(var t=this.values.length-1;t>-1&&!(this.num>=this.values[t]);t--);this.graphics.clear(),this.graphics.beginFill(this.colors[t]),this.graphics.drawRoundRect(0,0,this.len,this.len,this.len/4,this.len/4),this.graphics.endFill(),this.txt.text=this.num.toString()}else this.txt.text=""},e}(egret.Sprite);__reflect(Square.prototype,"Square");var SquareMap=function(){function t(t,e){this.anyChange=!0,this.row=t,this.col=e,this.resetMap()}return t.prototype.resetMap=function(){this.smap=[];for(var t=0;t<this.row;t++){for(var e=[],i=0;i<this.col;i++)e.push(null);this.smap.push(e)}},t.prototype.getAvailablePosition=function(){if(!this.anyChange)return null;var t=new egret.Point;do t.x=Math.floor(Math.random()*this.col),t.y=Math.floor(Math.random()*this.row);while(this.smap[t.y][t.x]);return t},t.prototype.moveSquares=function(t){var e,i,n,s=0;this.anyChange=!1,3>t?(e=this.col,n="y",i=1==t?0:this.row-1):(e=this.row,n="x",i=3==t?0:this.col-1);for(var o=0;e>o;o++){var r;r=3>t?this.getSquareByCol(o,t%2):this.getSquareByRow(o,t%2);for(var a=1;a<r.length;a++)if(null!=r[a]){for(var h=a-1;h>-1&&(!r[h]||0!=r[h].isRemoved);h--);if(0>h)r[a].position[n]=i,this.anyChange=!0;else if(r[h].isMegered||r[h].num!=r[a].num){var c=r[h].position[n]+(t%2?1:-1);r[a].position[n]!=c&&(this.anyChange=!0,r[a].position[n]=c)}else r[h].num==r[a].num&&(r[a].isRemoved=!0,r[a].position=r[h].position,r[h].isMegered=!0,r[h].num*=2,this.anyChange=!0,s++)}}return s},t.prototype.updateSquares=function(){for(var t=0;t<this.row;t++)for(var e=0;e<this.col;e++)this.smap[t][e]&&0==this.smap[t][e].isRemoved&&this.smap[t][e].update()},t.prototype.checkAlive=function(){for(var t=0;t<this.row;t++)for(var e=0;e<this.col;e++)if(null==this.smap[t][e])return!0;for(t=0;t<this.row;t++)for(e=0;e<this.col;e++){if(t<this.row-1&&this.smap[t][e].num==this.smap[t+1][e].num)return!0;if(e<this.col-1&&this.smap[t][e].num==this.smap[t][e+1].num)return!0}return!1},t.prototype.setSquare=function(t){this.smap[t.position.y][t.position.x]=t},t.prototype.getSquareByRow=function(t,e){for(var i=[],n=0;n<this.smap[t].length;n++)i.push(this.smap[t][n]);return e?i:i.reverse()},t.prototype.getSquareByCol=function(t,e){for(var i=[],n=0;n<this.row;n++)i.push(this.smap[n][t]);return e?i:i.reverse()},t.prototype.getAllSquares=function(){for(var t=[],e=0;e<this.smap.length;e++)for(var i=0;i<this.smap[e].length;i++)this.smap[e][i]&&t.push(this.smap[e][i]);return t},t}();__reflect(SquareMap.prototype,"SquareMap");